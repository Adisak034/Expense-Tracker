<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Dashboard</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <header>
        <h1>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</h1>
        <nav>
            <a href="/">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
            <a href="/add">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</a>
            <a href="/dashboard">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</a>
            <a href="/profile">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</a>
        </nav>
        <div class="user-info">
            <span id="user-welcome"></span>
            <button id="logout-btn" class="logout-btn">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
    </header>
    <main>
        <!-- Date Filter Section -->
        <section class="date-filter-section">
            <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</h2>
            <div class="filter-buttons">
                <button class="filter-btn active" data-period="today">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
                <button class="filter-btn" data-period="week">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</button>
                <button class="filter-btn" data-period="month">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</button>
                <button class="filter-btn" data-period="year">‡∏õ‡∏µ‡∏ô‡∏µ‡πâ</button>
                <button class="filter-btn" data-period="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            </div>
        </section>

        <!-- Summary Statistics -->
        <section class="summary-section">
            <div class="summary-cards">
                <div class="summary-card">
                    <div class="card-icon">üí∞</div>
                    <div class="card-content">
                        <h3>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</h3>
                        <p class="card-value" id="total-amount">‡∏ø0</p>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="card-icon">üìä</div>
                    <div class="card-content">
                        <h3>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h3>
                        <p class="card-value" id="total-count">0</p>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="card-icon">üìà</div>
                    <div class="card-content">
                        <h3>‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô</h3>
                        <p class="card-value" id="daily-average">‡∏ø0</p>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="card-icon">üèÜ</div>
                    <div class="card-content">
                        <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</h3>
                        <p class="card-value" id="max-expense">‡∏ø0</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Charts Section -->
        <section class="charts-section">
            <div class="chart-container">
                <div class="chart-box">
                    <h3>‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</h3>
                    <canvas id="expense-chart"></canvas>
                </div>
                <div class="chart-box">
                    <h3>‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</h3>
                    <canvas id="category-chart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-box full-width">
                    <h3>‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
                    <canvas id="trend-chart"></canvas>
                </div>
            </div>
        </section>

        <!-- Recent Expenses -->
        <section class="recent-expenses-section">
            <div class="section-header">
                <h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>
                <a href="/" class="view-all-btn">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</a>
            </div>
            <div class="recent-expenses-table">
                <div class="table-header">
                    <div class="header-cell">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</div>
                    <div class="header-cell">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                    <div class="header-cell">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</div>
                </div>
                <div id="recent-expenses-list" class="table-body">
                    <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
                </div>
            </div>
        </section>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/js/dashboard.js"></script>
    <script>
        // Add authentication check and logout functionality
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthStatus();
            initializeAuth();
        });

        function checkAuthStatus() {
            fetch('/api/auth/me')
                .then(response => {
                    if (!response.ok) {
                        window.location.href = '/login';
                        return;
                    }
                    return response.json();
                })
                .then(data => {
                    if (data && data.user) {
                        document.getElementById('user-welcome').textContent = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, ${data.user.username}`;
                    }
                })
                .catch(error => {
                    console.error('Auth check error:', error);
                    window.location.href = '/login';
                });
        }

        function initializeAuth() {
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', logout);
            }
        }

        function logout() {
            fetch('/api/auth/logout', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                window.location.href = '/login';
            })
            .catch(error => {
                console.error('Logout error:', error);
                window.location.href = '/login';
            });
        }
    </script>
</body>
</html>